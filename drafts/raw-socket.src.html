<!doctype html>
<html lang="en-US">
 <head>
  <meta charset=UTF-8>
  <title>Raw Sockets</title>
  <!-- W3C only -->
  <style>
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   pre code { color:inherit; background:transparent }
   .example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   .note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
   p.note::before { content:"Note: " }
   .XXX { padding:.5em; border:solid #f00 }
   p.XXX::before { content:"Issue: " }
   dl.switch { padding-left:2em }
   dl.switch > dt { text-indent:-1.5em }
   dl.switch > dt:before { content:'\21AA'; padding:0 0.5em 0 0; display:inline-block; width:1em; text-align:right; line-height:0.5em }
   dl.domintro { color: green; margin: 2em 0 2em 2em; padding: 0.5em 1em; border: none; background: #DDFFDD; }
   dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
   dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
   dl.domintro dd p { margin: 0.5em 0; }
   dl.domintro:before { display: table; margin: -1em -0.5em -0.5em auto; width: auto; content: 'This box is non-normative. Implementation requirements are given below this box.'; color: red; border: solid 2px; background: white; padding: 0 0.25em; }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   dfn { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   hr:not(.top) { display:block; background:none; border:none; padding:0; margin:2em 0; height:auto }
   table { border-collapse:collapse; border-style:hidden hidden none hidden }
   table thead { border-bottom:solid }
   table tbody th:first-child { border-left:solid }
   table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }

   .warning { color: red; background: transparent; font-weight: bolder; font-style: italic; }
   .warning p:first-child { margin-top: 0; }
   .warning p:last-child { margin-bottom: 0; }
   .warning:before { font-style: normal; }
   p.warning:before { content: '\26A0 Warning! '; }
  </style>
  <style>
   @media print {
     [data-anolis-spec]::after { content:"[" attr(data-anolis-spec) "]"; font-size:.6em; vertical-align:super; text-transform:uppercase }
   }
  </style>
  <link rel=stylesheet type=text/css href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS]" class=w3conly>
  <link rel=stylesheet href="http://www.whatwg.org/style/specification" class=now3c>
 </head>
 <body>

<div class=head>
<div class=w3conly>
<!--logo-->
</div>
 <h1>Raw Sockets</h1>
 <h2 class="no-num no-toc">
  <span class="w3conly">[LONGSTATUS] [DATE: 01 Jan 1901]</span>
  <span class="now3c">Free Editor's Draft [DATE: 01 Jan 1901]</span>
 </h2>

 <dl>
  <dt>This Version:
  <dd class=now3c><a href="#">http://???/</a>
  <dd class="dontpublish w3conly"><a href="http://dvcs.w3.org/hg/????/raw-file/tip/raw-socket.html">http://dvcs.w3.org/hg/???/raw-file/tip/raw-socket.html</a>
  <dd class=publish><a href="[VERSION]">[VERSION]</a>

  <dt class=dontpublish>Participate:</dt>
  <dd class=dontpublish>Send feedback to
  <a href="mailto:public-sysapps@w3.org?subject=%5BSocket%5D%20">public-sysapps@w3.org</a> (<a href="http://lists.w3.org/Archives/Public/public-sysapps/">archives</a>)

  <dt class=publish>Latest Version:
  <dd class=publish><a href="[LATEST]">[LATEST]</a>

  <dt class=publish>Latest Editors' Draft:
  <dd class=publish><a href="http://dvcs.w3.org/hg/???/raw-file/tip/Overview.html">http://dvcs.w3.org/hg/???/raw-file/tip/raw-socket.html</a>

  <dt>Editors:
  <dd>???
 </dl>

<p class="now3c copyright"><a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/"><img src="http://i.creativecommons.org/p/zero/1.0/80x15.png" alt="CC0"></a>
To the extent possible under law, the editors have waived all copyright and
related or neighboring rights to this work. In addition, as of
[DATE: 01 Jan 1901], the editors have made this specification available
under the
<a rel="license"
href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0">Open Web Foundation Agreement Version 1.0</a>,
which is available at
http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.

<div class=w3conly><!--copyright--></div>
<div class=publish>

<hr class=top>

<h2 class="no-num no-toc">Abstract</h2>
<p>Raw Sockets defines an interface for establishing and communicating over
TCP and UDP sockets.


<h2 class="no-num no-toc"><span id="sotd">Status of this Document</span></h2>
<p><i>This section describes the status of this document at the time of its
publication. Other documents may supersede this document. A list of current W3C
publications and the latest revision of this technical report can be found in
the <a href="http://www.w3.org/TR/">W3C technical reports index</a> at
http://www.w3.org/TR/.</i>

<p>This is the [DATE: 3 August 2002] [LONGSTATUS] of Raw Sockets. Please send
comments to
<a href="mailto:public-sysaps@w3.org?subject=%5BSockets%5D%20">public-sysapps@w3.org</a>
(<a href="http://lists.w3.org/Archives/Public/public-sysapps/">archived</a>)
with <samp>[Sockets]</samp> at the start of the subject line.

<p>This document is produced by the
<a href="http://www.w3.org/???/sysapps/">System Applications</a> (SysApps) Working
Group. The SysApps Working Group is part of the
<a href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients Activity</a> in
the W3C <a href="http://www.w3.org/Interaction/">Interaction Domain</a>.

<p>This document was produced by a group operating under the
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004
W3C Patent Policy</a>. W3C maintains a
<a rel="disclosure" href="http://www.w3.org/2004/01/pp-impl/42538/status">public
list of any patent disclosures</a> made in connection with the deliverables of
the group; that page also includes instructions for disclosing a patent. An
individual who has actual knowledge of a patent which the individual believes
contains
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
Claim(s)</a> must disclose the information in accordance with
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
6 of the W3C Patent Policy</a>.

<p>Publication as a Working Draft does not imply endorsement by the W3C
Membership. This is a draft document and may be updated, replaced or
obsoleted by other documents at any time. It is inappropriate to cite this
document as other than work in progress.
</div>
</div>



<h2 class="no-num no-toc">Table of Contents</h2>
<!--toc-->



<h2>Conformance</h2>
<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this document are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<span data-anolis-ref>RFC2119</span>

<p>Requirements phrased in the imperative as part of algorithms
(such as "strip any leading space characters" or "return false and
terminate these steps") are to be interpreted with the meaning of the
key word ("must", "should", "may", etc) used in introducing the
algorithm.

<p>Conformance requirements phrased as algorithms or specific steps
may be implemented in any manner, so long as the end result is
equivalent. (In particular, the algorithms defined in this
specification are intended to be easy to follow, and not intended to
be performant.)

<p id="hardwareLimitations">User agents may impose
implementation-specific limits on otherwise unconstrained inputs,
e.g. to prevent denial of service attacks, to guard against running
out of memory, or to work around platform-specific limitations.

<p>When a method or an attribute is said to call another method or attribute,
the user agent must invoke its internal API for that attribute or method so
that e.g. the author can't change the behavior by overriding attributes or
methods with custom properties or functions in ECMAScript.

<p>Unless otherwise stated, string comparisons are done in a
<span>case-sensitive</span> manner.

<h3>Dependencies</h3>

<p>The IDL fragments in this specification must be interpreted as
required for conforming IDL fragments, as described in the Web IDL
specification. <span data-anolis-ref>WEBIDL</span>

<p>Some of the terms used in this specification are defined in
<cite>Web IDL</cite>.
<span data-anolis-ref>WEBIDL</span>



<h2>Terminology</h2>

<p>TODO



<h2>Interfaces</h2>

<h3>Dictionaries</h3>

<pre class=idl>enum <dfn>SocketType</dfn> {
  tcp,
  udp
};

dictionary <dfn>CreateOptions</dfn> {
};

dictionary <dfn>CreateInfo</dfn> {
  long socketId;
};

dictionary <dfn>ReadInfo</dfn> {
  long resultCode;
  ArrayBuffer data;
};

dictionary <dfn>WriteInfo</dfn> {
  long bytesWritten;
};

dictionary <dfn>RecvFromInfo</dfn> {
  long resultCode;
  ArrayBuffer data;
  DOMString address;
  long port;
};</pre>

<h3>Callbacks</h3>

<pre class=idl>[NoInterfaceObject, Callback]
interface <dfn>CreateCallback</dfn> {
  void handleEvent(CreateInfo createInfo)
}

[NoInterfaceObject, Callback]
interface <dfn>ConnectCallback</dfn> {
  void handleEvent(long result)
}

[NoInterfaceObject, Callback]
interface <dfn>BindCallback</dfn> {
  void handleEvent(long result)
}

[NoInterfaceObject, Callback]
interface <dfn>ReadCallback</dfn> {
  void handleEvent(ReadInfo readInfo)
}

[NoInterfaceObject, Callback]
interface <dfn>WriteCallback</dfn> {
  void handleEvent(WriteInfo writeInfo)
}

[NoInterfaceObject, Callback]
interface <dfn>RecvFromCallback</dfn> {
  void handleEvent(RecvFromInfo writeInfo)
}

[NoInterfaceObject, Callback]
interface <dfn>SendToCallback</dfn> {
  void handleEvent(WriteInfo writeInfo)
}

[NoInterfaceObject, Callback]
interface <dfn>SetKeepAliveCallback</dfn> {
  void handleEvent(boolean result)
}

[NoInterfaceObject, Callback]
interface <dfn>SetNoDelayCallback</dfn> {
  void handleEvent(boolean result)
}</pre>

<h3>Socket</h3>

<pre class=idl>interface Socket {
  static void <span title=socket-Socket-create>create</span>(SocketType type, optional CreateOptions options, CreateCallback callback);
  static void <span title=socket-Socket-destroy>destroy</span>(long socketId);
  static void <span title=socket-Socket-connect>connect</span>(long socketId, DOMString hostname, long port, ConnectCallback callback);
  static void <span title=socket-Socket-bind>bind</span>(long socketId, DOMString address, long port, BindCallback callback);
  static void <span title=socket-Socket-disconnect>disconnect</span>(long socketId);
  static void <span title=socket-Socket-read>read</span>(long socketId, optional long bufferSize, ReadCallback callback);
  static void <span title=socket-Socket-write>write</span>(long socketId, ArrayBuffer data, WriteCallback callback);
  static void <span title=socket-Socket-recvFrom>recvFrom</span>(long socketId, optional long bufferSize, RecvFromCallback callback);
  static void <span title=socket-Socket-sendTo>sendTo</span>(long socketId, ArrayBuffer data, DOMString address, long port, SendToCallback callback);
  static void <span title=socket-Socket-setKeepAlive>setKeepAlive</span>(long socketId, boolean enable, optional long delay, SetKeepAliveCallback callback);
  static void <span title=socket-Socket-setNoDelay>setNoDelay</span>(long socketId, boolean noDelay, SetNoDelayCallback callback);
};</pre>

<p>FIXME: Why do we pass a <code>socketId</code> parameter to each of these
function rather than using member functions on a Socket object?

<p>The <dfn title=socket-Socket-create><code>create(<var>type</var>, <var>options</var>, <var>callback</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>
    <dl>
      <dt>If <var>type</var> is <code>tcp</code>,
      <dd>let <var>socket</var> be a TCP socket.
      <dt>Otherwise, if <var>type</var> is <code>udp</code>,
      <dd>let <var>socket</var> be a UDP socket.
      <dt>Otherwise,
      <dd><span data-anolis-spec=html>Queue a task</span> to invoke
        <var>callback</var> with a <code>CreateInfo</code> dictionary with <code>socketId</code> equal
        to 0 and abort these steps.
    </dl>
  <li>Assign a unique identifier <var>id</var> to <var>socket</var>.
  <li><span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with a <code>CreateInfo</code> dictionary with <code>socketId</code> equal
    to <var>id</var>.
</ol>

<p>The <dfn title=socket-Socket-destroy><code>destroy(<var>socketId</code>)</code></dfn>
function MUST destroy the socket. Each socket created SHOULD be destroyed after use.
FIXME: What happens to sockets in each state of the state machine?

<p>The <dfn title=socket-Socket-connect><code>connect(<var>socketId</var>, <var>hostname</var>, <var>port</var>, <var>callback</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>Let <var>address</var> be the result of resolving <var>hostname</var> via DNS.
  <li>Connect <var>socket</var> to <var>address</var> on port <var>port</var>.
  <li><span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with <code>result</code> equal to ???.
</ol>

<p>The <dfn title=socket-Socket-bind><code>bind(<var>socketId</var>, <var>address</var>, <var>port</var>, <var>callback</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>If <var>socket</var> is not a UDP socket,
    <span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with <code>result</code> ??? and abort these steps.
  <li>If <var>address</var> is not an address of the local machine,
    <span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with a <code>result</code> ??? and abort these steps.
  <li>Attempt to bind a UDP socket to <var>address</var> on port <var>port</var>.
  <li><span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with <code>result</code> ???.
</ol>

<p>The <dfn title=socket-Socket-disconnect><code>disconnect(<var>socketId</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>If <var>socket</var> is not a TCP socket, abort these steps.
  <li>Disconnect <var>socket</var> from the remote host.
</ol>

<p>The <dfn title=socket-Socket-read><code>read(<var>socketId</var>, <var>bufferSize</var>, <var>callback</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>Let <var>size</var> be the maximum of the number of bytes available for
    reading in <var>socket</var> without blocking and <var>bufferSize</var>
    (if <var>bufferSize</var> was specified).
  <li>Read <var>size</var> octets from <var>socket</var> and store the result in
    <var>incoming</var>.
  <li><span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with a <code>ReadInfo</code> dictionary with <code>data</code> containing
    <var>incoming</var> and <code>resultCode</code> equal to ???.
</ol>

<p>The <dfn title=socket-Socket-write><code>write(<var>socketId</var>, <var>data</var>, <var>callback</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>Let <var>outgoing</var> be the sequence of octets contained in <var>data</var>.
  <li>Attempt to write <var>outgoing</var> into <var>socket</var>.
  <li>
    <dl>
      <dt>If the write operation completes without blocking:
      <dd><span data-anolis-spec=html>Queue a task</span> to invoke
        <var>callback</var> with a <code>WriteInfo</code> dictionary with <code>bytesWritten</code>
        equal to the number of octets successfully written into the <var>socket</var>.
      <dt>If the write operation blocked before completing:
      <dd>
        <ol>
          <li><span data-anolis-spec=html>Queue a task</span> to invoke
            <var>callback</var> with a <code>WriteInfo</code> dictionary with <code>bytesWritten</code>
            equal to the number of octets successfully written into the <var>socket</var>.
          <li>Spin the event loop until the write operation completes.
          <li><span data-anolis-spec=html>Queue a task</span> to fire
            a ??? event on ???.
        </ol>
      <dt>If an error occurs:
      <dd><span data-anolis-spec=html>Queue a task</span> to ???
    </dl>
</ol>

<p>The <dfn title=socket-Socket-recvFrom><code>recvFrom(<var>socketId</var>, <var>bufferSize</var>, <var>callback</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>Let <var>size</var> be the maximum of the number of bytes available for
    reading in <var>socket</var> without blocking and <var>bufferSize</var>
    (if <var>bufferSize</var> was specified).
  <li>Read <var>size</var> octets from <var>socket</var> and store the result in
    <var>incoming</var>.
  <li><span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with a <code>RecvFromInfo</code> dictionary with:
    <ul>
      <li><code>resultCode</code> equal to ???
      <li><code>data</code> containing <var>incoming</var>.
      <li><code>address</code> equal to the address from which the user agent
        received <var>incoming</var>.
      <li><code>port</code> equal to the port from which the user agent
        received <var>incoming</var>.
    </ul>
</ol>

<p>The <dfn title=socket-Socket-sendTo><code>sendTo(<var>socketId</var>, <var>data</var>, <var>address</var>, <var>port</var>, <var>callback</var>)</code></dfn>
function must run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>Let <var>outgoing</var> be the sequence of octets contained in <var>data</var>.
  <li>Attempt to send <var>outgoing</var> to <var>address</var> on port <var>port</var>.
  <li>
    <dl>
      <dt>If the write operation completes without blocking:
      <dd><span data-anolis-spec=html>Queue a task</span> to invoke
        <var>callback</var> with a <code>WriteInfo</code> dictionary with <code>bytesWritten</code>
        equal to the number of octets successfully written into the <var>socket</var>.
      <dt>If the write operation blocked before completing:
      <dd>
        <ol>
          <li><span data-anolis-spec=html>Queue a task</span> to invoke
            <var>callback</var> with a <code>WriteInfo</code> dictionary with <code>bytesWritten</code>
            equal to the number of octets successfully written into the <var>socket</var>.
          <li>Spin the event loop until the write operation completes.
          <li><span data-anolis-spec=html>Queue a task</span> to fire
            a ??? event on ???.
        </ol>
      <dt>If an error occurs:
      <dd><span data-anolis-spec=html>Queue a task</span> to ???
    </dl>
</ol>

<p>The <dfn title=socket-Socket-setKeepAlive><code>setKeepAlive(<var>socketId</var>, <var>enable</var>, <var>delay</var>, <var>callback</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>Set the <var>keep alive</var> flag on <var>socket</var> to <var>enable</var>.
  <li>Set the <var>probe delay</var> value on <var>socket</var> to <var>delay</var> if <var>delay</var> was specified and 0 otherwise.
  <li><span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with <code>result</code> equal to ???
  <li>FIXME: Do we need to spec the keepalive loop or can we refer to another spec for that?
</ol>

<p>The <dfn title=socket-Socket-setNoDelay><code>setNoDelay(<var>socketId</var>, <var>noDelay</var>, <var>callback</var>)</code></dfn>
function MUST run the following steps:
<ol>
  <li>Return, but continue running these steps asynchronously.
  <li>Let <var>socket</var> be the socket with identifier <var>socketId</var>.
  <li>FIXME: Do sockets have a state machine that can throw an error here?
  <li>
    <dl>
      <dt>If <var>noDelay</var> is true,
      <dd>disable the Nagle algorithm for <var>socket</var>. FIXME: Citation needed.
      <dt>Otherwise,
      <dd>enable the Nagle algorithm.
    </dl>
  <li><span data-anolis-spec=html>Queue a task</span> to invoke
    <var>callback</var> with <code>result</code> equal to ???
</ol>

<h2 class=no-num>References</h2>
<div id=anolis-references></div>



<h2 class=no-num>Acknowledgments</h2>

<p>Thanks to

???

for their useful comments.

<script id=head src=http://www.whatwg.org/specs/web-apps/current-work/dfn.js class=dontpublish></script>
<!-- vim: set expandtab shiftwidth=1 tabstop=1 textwidth=76 -->
